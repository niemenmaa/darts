var Ke=Object.defineProperty;var Ze=(e,n,t)=>n in e?Ke(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var d=(e,n,t)=>Ze(e,typeof n!="symbol"?n+"":n,t);import{g as ze,b as et,c as ue,d as tt,e as nt,f as st,r as rt,I as me}from"./board-CNtetGwf.js";const V="dartsCounterGame",_e="dartsGameHistory",he=25;let S=[],z=null,o={players:[],currentPlayerIndex:0,startingScore:301,doubleOut:!0,currentTurn:{throws:[],scoreAtStart:0},gameStarted:!1,winner:null,mentalMathMode:!1};function p(){const e=new Date;e.setTime(e.getTime()+7*24*60*60*1e3);const n=encodeURIComponent(JSON.stringify(o));document.cookie=`${V}=${n};expires=${e.toUTCString()};path=/;SameSite=Strict`,ot()}function ot(){z&&z({...o})}function at(){const e=document.cookie.split(";");for(const n of e){const[t,s]=n.trim().split("=");if(t===V)try{const r=JSON.parse(decodeURIComponent(s));if(r&&r.players)return o={...o,...r},!0}catch(r){console.error("Failed to parse counter game cookie:",r)}}return!1}function it(){document.cookie=`${V}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`}function lt(){const e=ze();e&&(o.mentalMathMode=e.mentalMathMode??!1)}function ct(){const e=new Date;e.setTime(e.getTime()+30*24*60*60*1e3);const n=encodeURIComponent(JSON.stringify(S));document.cookie=`${_e}=${n};expires=${e.toUTCString()};path=/;SameSite=Strict`}function dt(){const e=document.cookie.split(";");for(const n of e){const[t,s]=n.trim().split("=");if(t===_e)try{const r=JSON.parse(decodeURIComponent(s));if(Array.isArray(r))return S=r,!0}catch(r){console.error("Failed to parse game history cookie:",r)}}return!1}function ut(){const e={id:Date.now(),timestamp:new Date().toISOString(),startingScore:o.startingScore,doubleOut:o.doubleOut,players:o.players.map(n=>({name:n.name,won:n.score===0,finalScore:n.score,rounds:[...n.history]}))};S.unshift(e),S.length>he&&(S=S.slice(0,he)),ct()}function mt(){return[...S]}function Se(e){if(!e||e.length===0)return 0;let n=0,t=0;for(const s of e)if(!s.bust){const r=s.throws.reduce((a,m)=>a+m.value,0);n+=r,t++}return t>0?n/t:0}function Ie(e){if(!e||e.length===0)return 0;let n=0,t=0;for(const s of e)for(const r of s.throws)n+=r.value,t++;return t>0?n/t:0}function Te(e){return!e||e.length===0?0:e.filter(n=>n.bust?!1:n.throws.reduce((s,r)=>s+r.value,0)>=100).length}function Ce(e){if(!e||e.length===0)return 0;const n=e.slice(0,3);let t=0,s=0;for(const r of n)for(const a of r.throws)t+=a.value,s++;return s>0?t/s*3:0}function ht(e,n){if(!e||e.length===0)return 0;let t=0;for(const s of e)if(!s.bust){const r=s.throws.reduce((a,m)=>a+m.value,0);t+=r}return t}function gt(e){const n=S.filter(r=>r.players.some(a=>a.name===e));if(n.length===0)return{gamesPlayed:0,gamesWon:0,winRate:0,avgPerTurn:0,avgPerDart:0,hundredPlusCount:0,firstNineAvg:0};let t=[],s=0;for(const r of n){const a=r.players.find(m=>m.name===e);a&&(t=t.concat(a.rounds),a.won&&s++)}return{gamesPlayed:n.length,gamesWon:s,winRate:s/n.length*100,avgPerTurn:Se(t),avgPerDart:Ie(t),hundredPlusCount:Te(t),firstNineAvg:Ce(t)}}function ft(e){return!e||!e.history?{avgPerTurn:0,avgPerDart:0,hundredPlusCount:0,firstNineAvg:0,totalPointsScored:0}:{avgPerTurn:Se(e.history),avgPerDart:Ie(e.history),hundredPlusCount:Te(e.history),firstNineAvg:Ce(e.history),totalPointsScored:ht(e.history,o.startingScore)}}lt();at();dt();function T(){return[...o.players]}function E(){return o.players[o.currentPlayerIndex]||null}function pt(){return o.gameStarted}function ae(){return o.winner}function Be(){return o.mentalMathMode}function ke(e){o.mentalMathMode=e,p()}function ge(e){return!e||e.trim()===""?!1:(o.players.push({name:e.trim(),score:o.startingScore,history:[]}),p(),!0)}function yt(e){return e>=0&&e<o.players.length?(o.players.splice(e,1),p(),!0):!1}function vt(e,n){return e>=0&&e<o.players.length&&n.trim()?(o.players[e].name=n.trim(),p(),!0):!1}function q(e,n){if(e<0||e>=o.players.length||n<0||n>=o.players.length||e===n)return!1;const[t]=o.players.splice(e,1);return o.players.splice(n,0,t),p(),!0}function fe(e){return e===301||e===501?(o.startingScore=e,p(),!0):!1}function xt(e){o.doubleOut=e,p()}function ee(){return o.doubleOut}function Pe(){return o.startingScore}function bt(){return o.players.length===0?!1:(o.players.forEach(e=>{e.score=o.startingScore,e.history=[]}),o.currentPlayerIndex=0,o.gameStarted=!0,o.winner=null,o.currentTurn={throws:[],scoreAtStart:o.startingScore},p(),!0)}function te(){o.gameStarted=!1,o.winner=null,o.currentPlayerIndex=0,o.currentTurn={throws:[],scoreAtStart:0},p()}function pe(){o.players=[],te(),it()}function wt(){if(!E())return 0;if(o.mentalMathMode)return o.currentTurn.scoreAtStart;const n=o.currentTurn.throws.reduce((t,s)=>t+s.value,0);return o.currentTurn.scoreAtStart-n}function Et(){if(!E())return 0;const n=o.currentTurn.throws.reduce((t,s)=>t+s.value,0);return o.currentTurn.scoreAtStart-n}function Lt(e,n,t=!1){if(!o.gameStarted||o.winner)return{success:!1,message:"Game not in progress"};if(!E())return{success:!1,message:"No current player"};const a=Et()-n;return o.doubleOut&&(a<0||a===1||a===0&&!t)?(o.currentTurn.throws.push({text:e,value:n,isDouble:t}),_t()):(o.currentTurn.throws.push({text:e,value:n,isDouble:t}),p(),a===0?St():o.currentTurn.throws.length>=3?It():{success:!0,bust:!1,win:!1})}function _t(){const e=E(),n=`Bust! ${e.name} stays at ${o.currentTurn.scoreAtStart}`;return e.history.push({round:e.history.length+1,throws:[...o.currentTurn.throws],bust:!0,scoreAfter:o.currentTurn.scoreAtStart}),Me(),p(),{success:!0,bust:!0,win:!1,message:n}}function St(){const e=E();return e.history.push({round:e.history.length+1,throws:[...o.currentTurn.throws],bust:!1,scoreAfter:0}),e.score=0,o.winner=e,p(),ut(),{success:!0,bust:!1,win:!0,message:`${e.name} wins!`}}function It(){const e=E(),n=o.currentTurn.throws.reduce((s,r)=>s+r.value,0),t=o.currentTurn.scoreAtStart-n;return e.score=t,e.history.push({round:e.history.length+1,throws:[...o.currentTurn.throws],bust:!1,scoreAfter:t}),Me(),p(),{success:!0,bust:!1,win:!1,turnComplete:!0}}function Me(){o.currentPlayerIndex=(o.currentPlayerIndex+1)%o.players.length;const e=E();o.currentTurn={throws:[],scoreAtStart:e.score}}function Tt(){if(o.currentTurn.throws.length===0)return{success:!1,message:"No throws to undo"};const e=o.currentTurn.throws.pop();return p(),{success:!0,removed:e}}function Ct(){return[...o.currentTurn.throws]}function Bt(e){z=e}function kt(){return{...o}}function Pt(e,n){if(!e)return!1;o={...o,players:e.players||o.players,currentPlayerIndex:e.currentPlayerIndex??o.currentPlayerIndex,startingScore:e.startingScore??o.startingScore,doubleOut:e.doubleOut??o.doubleOut,currentTurn:e.currentTurn||o.currentTurn,gameStarted:e.gameStarted??o.gameStarted,winner:e.winner,mentalMathMode:e.mentalMathMode??o.mentalMathMode};const t=new Date;t.setTime(t.getTime()+7*24*60*60*1e3);const s=encodeURIComponent(JSON.stringify(o));return document.cookie=`${V}=${s};expires=${t.toUTCString()};path=/;SameSite=Strict`,n&&n(),!0}(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var $e=class extends Event{constructor(n,t){super("error",t);d(this,"message");d(this,"error");this.message=n.message,this.error=n}},Ne=class extends Event{constructor(n=1e3,t="",s){super("close",s);d(this,"code");d(this,"reason");d(this,"wasClean",!0);this.code=n,this.reason=t}};const X={Event,ErrorEvent:$e,CloseEvent:Ne};function Mt(e,n){if(!e)throw new Error(n)}function $t(e){return new e.constructor(e.type,e)}function Nt(e){return"data"in e?new MessageEvent(e.type,e):"code"in e||"reason"in e?new Ne(e.code||1999,e.reason||"unknown reason",e):"error"in e?new $e(e.error,e):new Event(e.type,e)}var Le;const G=typeof process<"u"&&typeof((Le=process.versions)==null?void 0:Le.node)<"u"&&typeof document>"u"?Nt:$t,B={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:Number.POSITIVE_INFINITY,maxEnqueuedMessages:Number.POSITIVE_INFINITY};let ye=!1;var Ot=class P extends EventTarget{constructor(t,s,r={}){super();d(this,"_ws");d(this,"_retryCount",-1);d(this,"_uptimeTimeout");d(this,"_connectTimeout");d(this,"_shouldReconnect",!0);d(this,"_connectLock",!1);d(this,"_binaryType","blob");d(this,"_closeCalled",!1);d(this,"_messageQueue",[]);d(this,"_debugLogger",console.log.bind(console));d(this,"_url");d(this,"_protocols");d(this,"_options");d(this,"onclose",null);d(this,"onerror",null);d(this,"onmessage",null);d(this,"onopen",null);d(this,"_handleOpen",t=>{this._debug("open event");const{minUptime:s=B.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),s),Mt(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(r=>{var a;(a=this._ws)==null||a.send(r)}),this._messageQueue=[],this.onopen&&this.onopen(t),this.dispatchEvent(G(t))});d(this,"_handleMessage",t=>{this._debug("message event"),this.onmessage&&this.onmessage(t),this.dispatchEvent(G(t))});d(this,"_handleError",t=>{this._debug("error event",t.message),this._disconnect(void 0,t.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(t),this._debug("exec error listeners"),this.dispatchEvent(G(t)),this._connect()});d(this,"_handleClose",t=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(t),this.dispatchEvent(G(t))});this._url=t,this._protocols=s,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return P.CONNECTING}get OPEN(){return P.OPEN}get CLOSING(){return P.CLOSING}get CLOSED(){return P.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((t,s)=>(typeof s=="string"?t+=s.length:s instanceof Blob?t+=s.size:t+=s.byteLength,t),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?P.CLOSED:P.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}close(t=1e3,s){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,s)}reconnect(t,s){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,s),this._connect())}send(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{const{maxEnqueuedMessages:s=B.maxEnqueuedMessages}=this._options;this._messageQueue.length<s&&(this._debug("enqueue",t),this._messageQueue.push(t))}}_debug(...t){this._options.debug&&this._debugLogger("RWS>",...t)}_getNextDelay(){const{reconnectionDelayGrowFactor:t=B.reconnectionDelayGrowFactor,minReconnectionDelay:s=B.minReconnectionDelay,maxReconnectionDelay:r=B.maxReconnectionDelay}=this._options;let a=0;return this._retryCount>0&&(a=s*t**(this._retryCount-1),a>r&&(a=r)),this._debug("next delay",a),a}_wait(){return new Promise(t=>{setTimeout(t,this._getNextDelay())})}_getNextProtocols(t){if(!t)return Promise.resolve(null);if(typeof t=="string"||Array.isArray(t))return Promise.resolve(t);if(typeof t=="function"){const s=t();if(!s)return Promise.resolve(null);if(typeof s=="string"||Array.isArray(s))return Promise.resolve(s);if(s.then)return s}throw Error("Invalid protocols")}_getNextUrl(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){const s=t();if(typeof s=="string")return Promise.resolve(s);if(s.then)return s}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;const{maxRetries:t=B.maxRetries,connectionTimeout:s=B.connectionTimeout}=this._options;if(this._retryCount>=t){this._debug("max retries reached",this._retryCount,">=",t);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([r,a])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!ye&&(console.error(`‚ÄºÔ∏è No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),ye=!0);const m=this._options.WebSocket||WebSocket;this._debug("connect",{url:r,protocols:a}),this._ws=a?new m(r,a):new m(r),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),s)}).catch(r=>{this._connectLock=!1,this._handleError(new X.ErrorEvent(Error(r.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new X.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(t=1e3,s){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{(this._ws.readyState===this.OPEN||this._ws.readyState===this.CONNECTING)&&this._ws.close(t,s),this._handleClose(new X.CloseEvent(t,s,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};const Dt=e=>e[1]!==null&&e[1]!==void 0;function At(){if(crypto!=null&&crypto.randomUUID)return crypto.randomUUID();let e=Date.now(),n=(performance==null?void 0:performance.now)&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let s=Math.random()*16;return e>0?(s=(e+s)%16|0,e=Math.floor(e/16)):(s=(n+s)%16|0,n=Math.floor(n/16)),(t==="x"?s:s&3|8).toString(16)})}function Oe(e,n,t={}){const{host:s,path:r,protocol:a,room:m,party:i,basePath:l,prefix:h,query:c}=e;let u=s.replace(/^(http|https|ws|wss):\/\//,"");if(u.endsWith("/")&&(u=u.slice(0,-1)),r!=null&&r.startsWith("/"))throw new Error("path must not start with a slash");const x=i??"main",b=r?`/${r}`:"",g=a||(u.startsWith("localhost:")||u.startsWith("127.0.0.1:")||u.startsWith("192.168.")||u.startsWith("10.")||u.startsWith("172.")&&u.split(".")[1]>="16"&&u.split(".")[1]<="31"||u.startsWith("[::ffff:7f00:1]:")?n:`${n}s`),L=`${g}://${u}/${l||`${h||"parties"}/${x}/${m}`}${b}`,C=(v={})=>`${L}?${new URLSearchParams([...Object.entries(t),...Object.entries(v).filter(Dt)])}`,$=typeof c=="function"?async()=>C(await c()):C(c);return{host:u,path:b,room:m,name:x,protocol:g,partyUrl:L,urlProvider:$}}var Rt=class extends Ot{constructor(n){var s,r;const t=ve(n);super(t.urlProvider,t.protocols,t.socketOptions);d(this,"_pk");d(this,"_pkurl");d(this,"name");d(this,"room");d(this,"host");d(this,"path");this.partySocketOptions=n,this.setWSProperties(t),n.disableNameValidation||((s=n.party)!=null&&s.includes("/")&&console.warn(`PartySocket: party name "${n.party}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`),(r=n.room)!=null&&r.includes("/")&&console.warn(`PartySocket: room name "${n.room}" contains forward slash which may cause routing issues. Consider using a name without forward slashes or set disableNameValidation: true to bypass this warning.`))}updateProperties(n){const t=ve({...this.partySocketOptions,...n,host:n.host??this.host,room:n.room??this.room,path:n.path??this.path});this._url=t.urlProvider,this._protocols=t.protocols,this._options=t.socketOptions,this.setWSProperties(t)}setWSProperties(n){const{_pk:t,_pkurl:s,name:r,room:a,host:m,path:i}=n;this._pk=t,this._pkurl=s,this.name=r,this.room=a,this.host=m,this.path=i}reconnect(n,t){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(n,t)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(n,t){const s=Oe(n,"http"),r=typeof s.urlProvider=="string"?s.urlProvider:await s.urlProvider();return(n.fetch??fetch)(r,t)}};function ve(e){const{id:n,host:t,path:s,party:r,room:a,protocol:m,query:i,protocols:l,...h}=e,c=n||At(),u=Oe(e,"ws",{_pk:c});return{_pk:c,_pkurl:u.partyUrl,name:u.name,room:u.room,host:u.host,path:u.path,protocols:l,socketOptions:h,urlProvider:u.urlProvider}}const Gt="darts-counter.anttoni.partykit.dev";let w=null,M=null,j=null,_=null,N=!1;function Wt(){const e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let n="";for(let t=0;t<6;t++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}function xe(e,n,t){Ae(),M=e.toUpperCase(),j=n,_=t;try{return w=new Rt({host:Gt,room:M}),w.addEventListener("open",()=>{console.log(`üîó Connected to room: ${M}`),N=!0,_&&_({connected:!0,roomCode:M})}),w.addEventListener("message",s=>{try{const r=JSON.parse(s.data);r.type==="state"&&j&&j(r.state)}catch(r){console.error("Failed to parse message:",r)}}),w.addEventListener("close",()=>{console.log("üîå Disconnected from room"),N=!1,_&&_({connected:!1,roomCode:null})}),w.addEventListener("error",s=>{console.error("WebSocket error:",s),N=!1,_&&_({connected:!1,roomCode:null,error:!0})}),!0}catch(s){return console.error("Failed to connect:",s),!1}}function De(e){w&&N&&w.send(JSON.stringify({type:"state",state:e}))}function Ae(){w&&(w.close(),w=null),M=null,N=!1,j=null,_=null}function Q(){return N&&M!==null}function Re(){return M}let ne,se,re,A="player-setup",K=!1,W=null,k=null,U=!1,Z=!1;document.addEventListener("DOMContentLoaded",()=>{console.log("üéØ Counter Mode initialized"),Ut()});function Ut(){ne=document.getElementById("player-setup-screen"),se=document.getElementById("game-setup-screen"),re=document.getElementById("game-play-screen"),Ft(),Ht(),qt(),Yt(),Qt(),jt(),pt()?(ie(),ae()?(y("game-play"),ce()):y("game-play")):(T().length>0,y("player-setup"))}function jt(){Bt(e=>{Q()&&De(e)})}function Ft(){const e=document.getElementById("menu-btn"),n=document.getElementById("menu-dropdown"),t=document.getElementById("menu-share-btn"),s=document.getElementById("menu-settings-btn"),r=document.getElementById("menu-new-game-btn");e.addEventListener("click",a=>{a.stopPropagation(),n.classList.toggle("hidden")}),document.addEventListener("click",a=>{!n.contains(a.target)&&a.target!==e&&n.classList.add("hidden")}),t.addEventListener("click",()=>{n.classList.add("hidden"),Xt()}),s.addEventListener("click",()=>{n.classList.add("hidden"),Kt()}),r.addEventListener("click",()=>{n.classList.add("hidden"),Ue()})}function y(e){A=e,ne.classList.add("hidden"),se.classList.add("hidden"),re.classList.add("hidden"),e==="player-setup"?(ne.classList.remove("hidden"),I()):e==="game-setup"?(se.classList.remove("hidden"),oe(),Ge(),We(),J()):e==="game-play"&&(re.classList.remove("hidden"),R());const n=document.getElementById("menu-game-options");e==="game-play"?n.classList.remove("hidden"):n.classList.add("hidden")}function Ht(){const e=document.getElementById("player-name-input"),n=document.getElementById("add-player-btn"),t=document.getElementById("to-game-setup-btn");n.addEventListener("click",()=>{ge(e.value)&&(e.value="",e.focus(),I(),Y())}),e.addEventListener("keypress",s=>{s.key==="Enter"&&ge(e.value)&&(e.value="",I(),Y())}),t.addEventListener("click",()=>{T().length>0&&y("game-setup")})}function I(){const e=document.getElementById("player-list"),n=T();if(n.length===0){e.innerHTML=`
            <div class="flex flex-col items-center justify-center text-slate-400 py-16">
                <div class="text-6xl mb-4 opacity-40">üë•</div>
                <p class="text-lg font-medium">No players yet</p>
                <p class="text-sm text-slate-500 mt-1">Add at least one player to continue</p>
            </div>
        `;return}e.innerHTML=n.map((t,s)=>`
        <div class="flex items-center gap-2 p-3 bg-slate-800/60 rounded-xl border border-slate-700/50 group hover:border-slate-600 transition-all">
            <span class="w-8 h-8 flex items-center justify-center bg-gradient-to-br from-amber-500 to-amber-600 text-slate-900 font-bold rounded-lg text-sm shadow-md">
                ${s+1}
            </span>
            <span class="flex-1 text-white font-medium truncate">${O(t.name)}</span>
            <div class="flex items-center gap-1 opacity-60 group-hover:opacity-100 transition-opacity">
                <button class="move-up-btn w-8 h-8 flex items-center justify-center text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-all ${s===0?"invisible":""}" data-index="${s}" title="Move up">
                    ‚Üë
                </button>
                <button class="move-down-btn w-8 h-8 flex items-center justify-center text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-all ${s===n.length-1?"invisible":""}" data-index="${s}" title="Move down">
                    ‚Üì
                </button>
                <button class="edit-player-btn w-8 h-8 flex items-center justify-center text-slate-400 hover:text-amber-400 hover:bg-slate-700 rounded-lg transition-all" data-index="${s}" title="Edit">
                    ‚úèÔ∏è
                </button>
                <button class="delete-player-btn w-8 h-8 flex items-center justify-center text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded-lg transition-all" data-index="${s}" title="Remove">
                    √ó
                </button>
            </div>
        </div>
    `).join(""),e.querySelectorAll(".move-up-btn").forEach(t=>{t.addEventListener("click",()=>{const s=parseInt(t.dataset.index);q(s,s-1)&&I()})}),e.querySelectorAll(".move-down-btn").forEach(t=>{t.addEventListener("click",()=>{const s=parseInt(t.dataset.index);q(s,s+1)&&I()})}),e.querySelectorAll(".edit-player-btn").forEach(t=>{t.addEventListener("click",()=>{const s=parseInt(t.dataset.index),r=T(),a=prompt("Edit player name:",r[s].name);a!==null&&a.trim()&&(vt(s,a),I())})}),e.querySelectorAll(".delete-player-btn").forEach(t=>{t.addEventListener("click",()=>{const s=parseInt(t.dataset.index);yt(s),I(),Y()})})}function Y(){const e=document.getElementById("to-game-setup-btn");e.disabled=T().length===0}function qt(){const e=document.getElementById("mode-301-btn"),n=document.getElementById("mode-501-btn"),t=document.getElementById("double-out-toggle"),s=document.getElementById("mental-math-toggle"),r=document.getElementById("back-to-players-btn"),a=document.getElementById("start-game-btn");e.addEventListener("click",()=>{fe(301),oe()}),n.addEventListener("click",()=>{fe(501),oe()}),t.addEventListener("click",()=>{const m=t.dataset.enabled==="true";xt(!m),Ge()}),s.addEventListener("click",()=>{const m=s.dataset.enabled==="true";ke(!m),We()}),r.addEventListener("click",()=>{y("player-setup")}),a.addEventListener("click",()=>{bt()&&(ie(),y("game-play"))})}function oe(){const e=document.getElementById("mode-301-btn"),n=document.getElementById("mode-501-btn");Pe()===301?(e.className="w-28 py-4 rounded-xl font-bold text-2xl transition-all bg-amber-500 text-slate-900 shadow-lg shadow-amber-500/30 scale-105",n.className="w-28 py-4 rounded-xl font-bold text-2xl transition-all bg-slate-700 text-slate-300 hover:bg-slate-600 hover:text-white"):(e.className="w-28 py-4 rounded-xl font-bold text-2xl transition-all bg-slate-700 text-slate-300 hover:bg-slate-600 hover:text-white",n.className="w-28 py-4 rounded-xl font-bold text-2xl transition-all bg-amber-500 text-slate-900 shadow-lg shadow-amber-500/30 scale-105")}function Ge(){const e=document.getElementById("double-out-toggle"),n=e.querySelector("span"),t=ee();e.dataset.enabled=String(t),t?(e.classList.remove("bg-slate-600"),e.classList.add("bg-emerald-500"),n.classList.add("translate-x-5")):(e.classList.add("bg-slate-600"),e.classList.remove("bg-emerald-500"),n.classList.remove("translate-x-5"))}function We(){const e=document.getElementById("mental-math-toggle");if(!e)return;const n=e.querySelector("span"),t=Be();e.dataset.enabled=String(t),t?(e.classList.remove("bg-slate-600"),e.classList.add("bg-emerald-500"),n.classList.add("translate-x-5")):(e.classList.add("bg-slate-600"),e.classList.remove("bg-emerald-500"),n.classList.remove("translate-x-5"))}function J(){const e=document.getElementById("player-order-list"),n=T();e.innerHTML=n.map((t,s)=>`
        <div class="flex items-center gap-2 p-3 bg-slate-800/60 rounded-xl border border-slate-700/50 group hover:border-slate-600 transition-all">
            <span class="w-7 h-7 flex items-center justify-center bg-gradient-to-br from-amber-500 to-amber-600 text-slate-900 font-bold rounded-md text-xs shadow">
                ${s+1}
            </span>
            <span class="flex-1 text-white font-medium truncate text-sm">${O(t.name)}</span>
            <div class="flex items-center gap-1 opacity-60 group-hover:opacity-100 transition-opacity">
                <button class="order-move-up-btn w-7 h-7 flex items-center justify-center text-slate-400 hover:text-white hover:bg-slate-700 rounded-md transition-all text-sm ${s===0?"invisible":""}" data-index="${s}">
                    ‚Üë
                </button>
                <button class="order-move-down-btn w-7 h-7 flex items-center justify-center text-slate-400 hover:text-white hover:bg-slate-700 rounded-md transition-all text-sm ${s===n.length-1?"invisible":""}" data-index="${s}">
                    ‚Üì
                </button>
            </div>
        </div>
    `).join(""),e.querySelectorAll(".order-move-up-btn").forEach(t=>{t.addEventListener("click",()=>{const s=parseInt(t.dataset.index);q(s,s-1)&&J()})}),e.querySelectorAll(".order-move-down-btn").forEach(t=>{t.addEventListener("click",()=>{const s=parseInt(t.dataset.index);q(s,s+1)&&J()})})}function Yt(){const e=document.getElementById("blank-btn"),n=document.getElementById("undo-btn"),t=document.getElementById("player-list-btn");e.addEventListener("click",()=>{F({text:"0",value:0,isDouble:!1})}),n.addEventListener("click",()=>{Tt().success&&R()}),t.addEventListener("click",()=>{qe()})}function ie(){const e=document.getElementById("board-container");e.innerHTML="";const n=et();e.appendChild(n),Jt(n)}function Jt(e){function n(){const i=e.getBoundingClientRect();return{x:i.left+i.width/2,y:i.top+i.height/2}}function t(i,l){const h=n(),c=i-h.x,u=l-h.y;return Math.sqrt(c*c+u*u)}function s(i,l,h){K=!0,U=!1,W=t(i,l),k=null;const c=h.target.closest("[data-score]"),u=c&&c.dataset.score==="50",x=ue(h,e);Z=u||x>=me}function r(i,l,h){if(!K||!Z)return;const c=t(i,l);!k&&Math.abs(c-W)>5&&(k=c>W?"out":"in",U=!0),k==="out"?tt(h):k==="in"&&nt(h)}function a(i){if(k){const l=st();if(l){const h=l.text.startsWith("D")||l.value===50;F({text:l.text,value:l.value,isDouble:h})}}rt(),K=!1,W=null,k=null,Z=!1}function m(i){if(U){U=!1;return}const l=i.target.closest("[data-score]");if(l){if(l.dataset.score==="50")F({text:"50",value:50,isDouble:!0});else if(ue(i,e)>=me){const c=parseInt(l.dataset.score);F({text:String(c),value:c,isDouble:!1})}}}e.addEventListener("mousedown",i=>s(i.clientX,i.clientY,i)),e.addEventListener("mousemove",i=>r(i.clientX,i.clientY,i)),e.addEventListener("mouseup",i=>a()),e.addEventListener("mouseleave",i=>a()),e.addEventListener("click",m),e.addEventListener("touchstart",i=>{const l=i.touches[0];s(l.clientX,l.clientY,i)},{passive:!0}),e.addEventListener("touchmove",i=>{const l=i.touches[0];r(l.clientX,l.clientY,i)},{passive:!0}),e.addEventListener("touchend",i=>a()),e.addEventListener("touchcancel",i=>a())}function F(e){if(ae())return;const n=Lt(e.text,e.value,e.isDouble);n.success&&(R(),n.bust?be(n.message,"text-red-400"):n.win?ce():n.turnComplete&&be("Next player","text-slate-400"))}function R(){const e=E();if(!e)return;const n=document.getElementById("remaining-score");n.textContent=wt();const t=document.getElementById("current-player-name");t.textContent=e.name;const s=document.getElementById("turn-throws"),r=Ct();r.length>0?s.textContent=r.map(m=>m.text).join("  ‚Ä¢  "):s.textContent="";const a=document.getElementById("undo-btn");a.disabled=r.length===0,Vt()}function Vt(){const e=document.getElementById("all-players-scores"),n=T(),t=E();if(n.length<=1){e.innerHTML="";return}e.innerHTML=n.map(s=>{const r=t&&s.name===t.name,a=s.score===0;return`
            <div class="flex items-center gap-1.5 px-2 py-1 rounded-lg ${r?"bg-amber-500/30 ring-1 ring-amber-500/50":"bg-slate-800/60"}">
                <span class="text-xs font-medium ${r?"text-amber-300":"text-slate-400"} truncate max-w-16">${O(s.name)}</span>
                <span class="text-sm font-bold tabular-nums ${a?"text-emerald-400":r?"text-amber-400":"text-white"}">${s.score}</span>
            </div>
        `}).join("")}function be(e,n="text-slate-400"){const t=document.getElementById("game-message");t.textContent=e,t.className=`text-center text-lg font-bold mt-3 h-8 ${n}`,setTimeout(()=>{t.textContent=""},1500)}function Qt(){const e=document.getElementById("close-player-list-modal"),n=document.getElementById("player-list-modal"),t=document.getElementById("new-game-btn"),s=document.getElementById("all-scores-btn");e.addEventListener("click",()=>{n.classList.add("hidden"),n.classList.remove("flex")}),n.addEventListener("click",f=>{f.target===n&&(n.classList.add("hidden"),n.classList.remove("flex"))}),t.addEventListener("click",()=>{n.classList.add("hidden"),n.classList.remove("flex"),Ue()}),s.addEventListener("click",()=>{n.classList.add("hidden"),n.classList.remove("flex"),Zt()});const r=document.getElementById("all-scores-modal"),a=document.getElementById("close-all-scores-modal"),m=document.getElementById("back-to-scores-btn");a.addEventListener("click",()=>{r.classList.add("hidden"),r.classList.remove("flex")}),m.addEventListener("click",()=>{r.classList.add("hidden"),r.classList.remove("flex"),qe()}),r.addEventListener("click",f=>{f.target===r&&(r.classList.add("hidden"),r.classList.remove("flex"))});const i=document.getElementById("winner-modal"),l=document.getElementById("winner-same-players-btn"),h=document.getElementById("winner-start-fresh-btn");l.addEventListener("click",()=>{i.classList.add("hidden"),i.classList.remove("flex"),te(),y("game-setup")}),h.addEventListener("click",()=>{i.classList.add("hidden"),i.classList.remove("flex"),pe(),y("player-setup")});const c=document.getElementById("new-game-modal"),u=document.getElementById("new-game-keep-players-btn"),x=document.getElementById("new-game-clear-all-btn"),b=document.getElementById("new-game-cancel-btn");u.addEventListener("click",()=>{c.classList.add("hidden"),c.classList.remove("flex"),te(),y("game-setup")}),x.addEventListener("click",()=>{c.classList.add("hidden"),c.classList.remove("flex"),pe(),y("player-setup")}),b.addEventListener("click",()=>{c.classList.add("hidden"),c.classList.remove("flex")}),c.addEventListener("click",f=>{f.target===c&&(c.classList.add("hidden"),c.classList.remove("flex"))});const g=document.getElementById("counter-settings-modal"),L=document.getElementById("close-settings-modal"),C=document.getElementById("close-settings-btn"),$=document.getElementById("settings-mental-math-toggle");L.addEventListener("click",()=>{g.classList.add("hidden"),g.classList.remove("flex")}),C.addEventListener("click",()=>{g.classList.add("hidden"),g.classList.remove("flex")}),g.addEventListener("click",f=>{f.target===g&&(g.classList.add("hidden"),g.classList.remove("flex"))}),$.addEventListener("click",()=>{const f=$.dataset.enabled==="true";ke(!f),He(),R()});const v=document.getElementById("share-game-modal"),Je=document.getElementById("close-share-modal"),Ve=document.getElementById("close-share-btn"),Qe=document.getElementById("create-room-btn"),de=document.getElementById("join-room-btn"),D=document.getElementById("join-room-input"),Xe=document.getElementById("disconnect-btn");Je.addEventListener("click",()=>{v.classList.add("hidden"),v.classList.remove("flex")}),Ve.addEventListener("click",()=>{v.classList.add("hidden"),v.classList.remove("flex")}),v.addEventListener("click",f=>{f.target===v&&(v.classList.add("hidden"),v.classList.remove("flex"))}),Qe.addEventListener("click",()=>{const f=Wt();xe(f,we,Ee),setTimeout(()=>{Q()&&De(kt())},500)}),de.addEventListener("click",()=>{const f=D.value.trim().toUpperCase();if(f.length!==6){je("Please enter a 6-character code");return}xe(f,we,Ee)}),D.addEventListener("keypress",f=>{f.key==="Enter"&&de.click()}),D.addEventListener("input",()=>{D.value=D.value.toUpperCase()}),Xe.addEventListener("click",()=>{Ae(),le(),Fe()})}function Ue(){const e=document.getElementById("new-game-modal");e.classList.remove("hidden"),e.classList.add("flex")}function Xt(){const e=document.getElementById("share-game-modal");le(),e.classList.remove("hidden"),e.classList.add("flex")}function le(){const e=document.getElementById("share-connected-status"),n=document.getElementById("share-create-section"),t=document.getElementById("share-current-code");document.getElementById("join-error").classList.add("hidden"),Q()?(e.classList.remove("hidden"),n.classList.add("hidden"),t.textContent=Re()):(e.classList.add("hidden"),n.classList.remove("hidden"))}function we(e){Pt(e,()=>{e.gameStarted?(A!=="game-play"?(ie(),y("game-play")):R(),e.winner&&ce()):e.players&&e.players.length>0&&(A==="game-play"&&y("game-setup"),A==="player-setup"?(I(),Y()):A==="game-setup"&&J())})}function Ee(e){le(),Fe(),e.error&&je("Failed to connect. Please try again.")}function je(e){const n=document.getElementById("join-error");n.textContent=e,n.classList.remove("hidden"),setTimeout(()=>{n.classList.add("hidden")},3e3)}function Fe(){const e=document.getElementById("sync-status"),n=document.getElementById("sync-room-code");Q()?(e.classList.remove("hidden"),n.textContent=Re()):e.classList.add("hidden")}function Kt(){const e=document.getElementById("counter-settings-modal"),n=document.getElementById("settings-starting-score"),t=document.getElementById("settings-double-out");n.textContent=Pe(),t.textContent=ee()?"Yes":"No",t.className=`text-sm font-medium ${ee()?"text-emerald-400":"text-slate-400"}`,He(),e.classList.remove("hidden"),e.classList.add("flex")}function He(){const e=document.getElementById("settings-mental-math-toggle");if(!e)return;const n=e.querySelector("span"),t=Be();e.dataset.enabled=String(t),t?(e.classList.remove("bg-slate-600"),e.classList.add("bg-emerald-500"),n.classList.add("translate-x-5")):(e.classList.add("bg-slate-600"),e.classList.remove("bg-emerald-500"),n.classList.remove("translate-x-5"))}let H=null;function qe(){const e=document.getElementById("player-list-modal");H=null,Ye(),e.classList.remove("hidden"),e.classList.add("flex")}function Ye(){const e=document.getElementById("modal-player-scores"),n=T(),t=E();e.innerHTML=n.map((s,r)=>{const a=t&&s.name===t.name,m=s.score===0,i=H===r,l=ft(s);let h="";return i&&s.history&&s.history.length>0?h=`
                <div class="mt-2 pt-2 border-t border-slate-600/50">
                    <div class="grid grid-cols-2 gap-x-4 gap-y-1 text-xs mb-2">
                        <div class="text-slate-400">AVG/turn: <span class="text-white font-medium">${l.avgPerTurn.toFixed(1)}</span></div>
                        <div class="text-slate-400">AVG/dart: <span class="text-white font-medium">${l.avgPerDart.toFixed(1)}</span></div>
                        <div class="text-slate-400">100+: <span class="text-white font-medium">${l.hundredPlusCount}</span></div>
                        <div class="text-slate-400">First 9: <span class="text-white font-medium">${l.firstNineAvg.toFixed(1)}</span></div>
                    </div>
                    <div class="text-xs text-slate-500 mb-1">Rounds:</div>
                    <div class="flex flex-wrap gap-1">
                        ${s.history.map((c,u)=>{const x=c.throws.reduce((g,L)=>g+L.value,0),b=c.throws.map(g=>g.text).join("-");return`<span class="px-1.5 py-0.5 rounded text-xs ${c.bust?"bg-red-900/50 text-red-300":x>=100?"bg-emerald-900/50 text-emerald-300":"bg-slate-700 text-slate-300"}" title="${b}">${x}${c.bust?"‚úó":""}</span>`}).join("")}
                    </div>
                </div>
            `:i&&(h='<div class="mt-2 pt-2 border-t border-slate-600/50 text-xs text-slate-500">No throws yet</div>'),`
            <div class="player-score-card rounded-xl transition-all cursor-pointer ${a?"bg-amber-500/20 ring-1 ring-amber-500/50":"bg-slate-700/50 hover:bg-slate-700/70"}" data-player-index="${r}">
                <div class="flex items-center justify-between p-3">
                    <div class="flex items-center gap-2">
                        <span class="text-slate-500 text-sm">${i?"‚ñº":"‚ñ∂"}</span>
                        <span class="w-7 h-7 flex items-center justify-center ${a?"bg-gradient-to-br from-amber-500 to-amber-600":"bg-slate-600"} text-${a?"slate-900":"white"} font-bold rounded-md text-xs">
                            ${r+1}
                        </span>
                        <span class="text-white font-medium text-sm">${O(s.name)}</span>
                    </div>
                    <span class="text-xl font-bold tabular-nums ${m?"text-emerald-400":"text-white"}">${s.score}</span>
                </div>
                ${h}
            </div>
        `}).join(""),e.querySelectorAll(".player-score-card").forEach(s=>{s.addEventListener("click",()=>{const r=parseInt(s.dataset.playerIndex);H=H===r?null:r,Ye()})})}function ce(){const e=ae();if(!e)return;const n=document.getElementById("winner-modal"),t=document.getElementById("winner-name");t.textContent=e.name,n.classList.remove("hidden"),n.classList.add("flex")}function Zt(){const e=document.getElementById("all-scores-modal"),n=document.getElementById("all-scores-content"),t=mt();if(t.length===0)n.innerHTML=`
            <div class="flex flex-col items-center justify-center text-slate-400 py-12">
                <div class="text-5xl mb-3 opacity-40">üìä</div>
                <p class="text-base font-medium">No games played yet</p>
                <p class="text-sm text-slate-500 mt-1">Complete a game to see history</p>
            </div>
        `;else{const s=new Set;t.forEach(i=>{i.players.forEach(l=>s.add(l.name))});const r=Array.from(s);let a=`
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-slate-600">
                            <th class="text-left py-2 px-2 text-slate-400 font-medium text-xs">Game</th>
                            ${r.map(i=>`<th class="text-center py-2 px-2 text-slate-400 font-medium text-xs truncate max-w-20">${O(i)}</th>`).join("")}
                        </tr>
                    </thead>
                    <tbody>
        `;t.forEach((i,l)=>{const h=t.length-l,c=new Date(i.timestamp),u=`${c.getMonth()+1}/${c.getDate()}`;a+=`
                <tr class="border-b border-slate-700/50 hover:bg-slate-700/30">
                    <td class="py-2 px-2">
                        <div class="text-white font-medium">#${h}</div>
                        <div class="text-xs text-slate-500">${i.startingScore} ‚Ä¢ ${u}</div>
                    </td>
            `,r.forEach(x=>{const b=i.players.find(g=>g.name===x);if(b){const g=b.rounds.reduce((L,C)=>C.bust?L:L+C.throws.reduce(($,v)=>$+v.value,0),0);a+=`
                        <td class="py-2 px-2 text-center">
                            <span class="font-bold tabular-nums ${b.won?"text-emerald-400":"text-white"}">${g}</span>
                            ${b.won?'<span class="text-emerald-400 ml-1">‚úì</span>':""}
                        </td>
                    `}else a+='<td class="py-2 px-2 text-center text-slate-600">-</td>'}),a+="</tr>"}),a+=`
                    </tbody>
                </table>
            </div>
        `;let m=`
            <div class="mt-4 pt-4 border-t border-slate-700">
                <h3 class="text-sm font-medium text-slate-400 mb-2">Player Statistics</h3>
                <div class="space-y-2">
        `;r.forEach(i=>{const l=gt(i);m+=`
                <div class="bg-slate-700/50 rounded-lg p-2">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-white font-medium text-sm">${O(i)}</span>
                        <span class="text-xs text-slate-400">${l.gamesWon}/${l.gamesPlayed} wins (${l.winRate.toFixed(0)}%)</span>
                    </div>
                    <div class="grid grid-cols-4 gap-2 text-xs">
                        <div class="text-slate-400">AVG/T: <span class="text-white">${l.avgPerTurn.toFixed(1)}</span></div>
                        <div class="text-slate-400">AVG/D: <span class="text-white">${l.avgPerDart.toFixed(1)}</span></div>
                        <div class="text-slate-400">100+: <span class="text-white">${l.hundredPlusCount}</span></div>
                        <div class="text-slate-400">F9: <span class="text-white">${l.firstNineAvg.toFixed(1)}</span></div>
                    </div>
                </div>
            `}),m+="</div></div>",n.innerHTML=a+m}e.classList.remove("hidden"),e.classList.add("flex")}function O(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}
